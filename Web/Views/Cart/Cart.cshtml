@model List<ViewModel.ViewModels.CartItem>




<!DOCTYPE html>
<!--
    ustora by freshdesignweb.com
    Twitter: https://twitter.com/freshdesignweb
    URL: https://www.freshdesignweb.com/ustora/
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cart Page - Ustora Demo</title>

    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,700,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,100' rel='stylesheet' type='text/css'>

    <!-- Bootstrap -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>



    <div class="single-product-area">
        <div class="zigzag-bottom"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-4">

                    <div class="single-sidebar">
                        <h2 class="sidebar-title">Products</h2>
                        <div class="thubmnail-recent">
                            <img src="/img/product-thumb-1.jpg" class="recent-thumb" alt="">
                            <h2><a href="single-product.html">Sony Smart TV - 2015</a></h2>
                            <div class="product-sidebar-price">
                                <ins>$700.00</ins> <del>$800.00</del>
                            </div>
                        </div>
                        <div class="thubmnail-recent">
                            <img src="/img/product-thumb-1.jpg" class="recent-thumb" alt="">
                            <h2><a href="single-product.html">Sony Smart TV - 2015</a></h2>
                            <div class="product-sidebar-price">
                                <ins>$700.00</ins> <del>$800.00</del>
                            </div>
                        </div>
                        <div class="thubmnail-recent">
                            <img src="/img/product-thumb-1.jpg" class="recent-thumb" alt="">
                            <h2><a href="single-product.html">Sony Smart TV - 2015</a></h2>
                            <div class="product-sidebar-price">
                                <ins>$700.00</ins> <del>$800.00</del>
                            </div>
                        </div>
                        <div class="thubmnail-recent">
                            <img src="/img/product-thumb-1.jpg" class="recent-thumb" alt="">
                            <h2><a href="single-product.html">Sony Smart TV - 2015</a></h2>
                            <div class="product-sidebar-price">
                                <ins>$700.00</ins> <del>$800.00</del>
                            </div>
                        </div>
                    </div>

                    <div class="single-sidebar">
                        <h2 class="sidebar-title">Recent Posts</h2>
                        <ul>
                            <li><a href="#">Sony Smart TV - 2015</a></li>
                            <li><a href="#">Sony Smart TV - 2015</a></li>
                            <li><a href="#">Sony Smart TV - 2015</a></li>
                            <li><a href="#">Sony Smart TV - 2015</a></li>
                            <li><a href="#">Sony Smart TV - 2015</a></li>
                        </ul>
                    </div>
                </div>

                @if (Model.Count > 0)
                {
                    var stt = 1;
                    decimal total = 0;
                    <div class="col-md-8">
                        <div class="product-content-right">
                            <div class="woocommerce">
                                <form method="post" action="#">
                                    <table cellspacing="0" class="shop_table cart">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th class="product-remove">&nbsp;</th>
                                                <th class="product-thumbnail">&nbsp;</th>
                                                <th class="product-name">Product</th>
                                                <th class="product-price">Price</th>
                                                <th class="product-quantity">Quantity</th>
                                                <th class="product-subtotal">Total</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            @foreach (var cart in Model)
                                            {
                                                if (cart.Product.isGift == false)
                                                {
                                                    int thanhtien = (int)cart.Quantity * (int)cart.Product.Price;
                                                    total += thanhtien;
                                                    var a = (int)cart.Product.Price;

                                                    <tr class="cart_item">
                                                        <td>@(stt++)</td>
                                                        <td class="product-remove">
                                                            <a title="Remove this item" class="remove" href="@Url.ActionLink("RemoveCart", "Cart", new { IdProduct = cart.Product.IdProduct })">×</a>
                                                        </td>

                                                        <td style="height:100px ;width:80px" class="product-thumbnail">
                                                            <a href="single-product.html"><img alt="poster_1_up" class="shop_thumbnail" src="~/@cart.Product.PhotoReview"></a>
                                                        </td>

                                                        <td class="product-name">
                                                            <a href="single-product.html">@cart.Product.ProductName</a>
                                                        </td>

                                                        <td class="product-price">
                                                            <span class="amount">@a</span>
                                                        </td>

                                                        <td class="product-quantity">
                                                            <div class="quantity buttons_added">
                                                                <input type="number" size="4" asp-for="@cart.Quantity" id="Quanlity@(cart.Product.IdProduct)" class="input-text qty text" title="Qty">
                                                            </div>
                                                        </td>

                                                        <td class="product-subtotal">
                                                            <span class="amount">@thanhtien</span>
                                                        </td>
                                                        <td>
                                                            <button class="btn btn-success updatecartitem" data-productId="@cart.Product.IdProduct">
                                                                Cập Nhật
                                                            </button>
                                                        </td>
                                                    </tr>
                                                }
                                                else
                                                {
                                        <tr class="cart_item">
                                            <td>@(stt++)</td>
                                            <td colspan="2" style="height:100px ;width:80px" class="product-thumbnail">
                                                <a href="single-product.html"><img alt="poster_1_up" class="shop_thumbnail" src="~/@cart.Product.PhotoReview"></a>
                                            </td>

                                            <td colspan="2" class="product-name">
                                                <a href="single-product.html">@cart.Product.ProductName</a>
                                            </td>
                                            <td class="product-quantity">
                                                <div class="quantity buttons_added">
                                                    <input type="number" size="4" value="1" disabled>
                                                </div>
                                            </td>
                                            <td colspan="2">
                                                <a class="btn btn-danger">
                                                    Sản phẩm tặng kèm miễn phí
                                                </a>
                                            </td>
                                        </tr>
                                                }

                                            }

                                            @*<tr class="cart_item">
            <td class="product-remove">
                <a title="Remove this item" class="remove" href="#">×</a>
            </td>

            <td class="product-thumbnail">
                <a href="single-product.html"><img width="145" height="145" alt="poster_1_up" class="shop_thumbnail" src="/img/product-thumb-2.jpg"></a>
            </td>

            <td class="product-name">
                <a href="single-product.html">Ship Your Idea</a>
            </td>

            <td class="product-price">
                <span class="amount">£15.00</span>
            </td>

            <td class="product-quantity">
                <div class="quantity buttons_added">
                    <input type="button" class="minus" value="-">
                    <input type="number" size="4" class="input-text qty text" title="Qty" value="1" min="0" step="1">
                    <input type="button" class="plus" value="+">
                </div>
            </td>

            <td class="product-subtotal">
                <span class="amount">£15.00</span>
            </td>
        </tr>*@


                                            <tr>
                                                <td class="actions">
                                                    <a href="/Cart/Checkout" class="btn btn-primary">Checkout</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </form>

                                <div class="cart-collaterals">


                                    <div class="cart_totals ">
                                        <h2>Cart Totals</h2>

                                        <table cellspacing="0">
                                            <tbody>
                                                <tr class="cart-subtotal">
                                                    <th>Cart Subtotal</th>
                                                    <td><span class="amount">@total</span></td>
                                                </tr>
                                               <tr class="shipping">
                                                    <th>Shipping and Handling</th>
                                                    <td>Free Shipping</td>
                                                </tr>

                                                <tr class="order-total">
                                                    <th>Order Total</th>
                                                    <td id="totalmoney2">@total </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>


                                   


                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>


    <!-- Latest jQuery form server -->
    <script src="https://code.jquery.com/jquery.min.js"></script>

    <!-- Bootstrap JS form CDN -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- jQuery sticky menu -->
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>

    <!-- jQuery easing -->
    <script src="/js/jquery.easing.1.3.min.js"></script>

    <!-- Main Script -->
    <script src="/js/main.js"></script>
</body>
</html>

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".updatecartitem").click(function (event) {
                event.preventDefault();
                var text = "#Quanlity";
                var idproduct = $(this).attr("data-productId"); //truyền thuộc tính
                text += idproduct;
                var quantity = $(text).val();       //truyền thuộc tính
                $.ajax({
                    type: "POST",               //update
                    url: '/Cart/UpdateCart',
                    data: {
                        idproduct: idproduct,
                        Quantity: quantity
                    },
                    success: function (result) {
                        window.location.href = '/Cart/Cart'
                    }

                });
            });
        });

        $(document).ready(function () {
            $(".purchase").click(function (event) {
                event.preventDefault();
                swal({
                    title: "Xác nhận đơn hàng",
                    text: "Đơn hàng sẽ không được hoàn trả khi đặt,bạn có muốn đặt không?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Cảm ơn, Mua hàng",

                    cancelButtonText: "Đóng,chưa mua",
                    closeOnConfirm: false,
                    closeOnCancel: false
                },
                    function (isConfirm) {
                        if (isConfirm) {
                            var Total = $(this).attr("data-total");
                            var voucherCOde = $("#vouchercode").val();
                            $.ajax({
                                type: "POST",               //update
                                url: '/Cart/Purchase',
                                data: {
                                    Total: Total,
                                    voucherCode: voucherCOde
                                },
                                success: function (result) {
                                    window.alert = 'Order Success'
                                    window.location.href = '/Cart/Success'
                                }
                            });
                        } else {
                            swal("Đóng", "Đơn hàng chưa được gửi, làm ơn hoàn tất đơn hàng", "error");

                        }

                    });          
                 });
             });

        $(document).ready(function () {
            $(".paypal").click(function (event) {
                event.preventDefault();
                var Total = $(this).attr("data-total");
                $.ajax({
                    type: "POST",
                    url: '/Cart/PayPal',
                    data: {
                        Total: Total,
                    },
                    success: function (result) {
                        window.location.href = result;
                    }
                });
            });
        });


        $(document).ready(function () { //cart voucher js
            $("#voucher").click(function (event) {
                event.preventDefault();
                var Total = parseInt($(this).attr("data-total"));
                var idvoucher = $("#vouchercode").val();
                if (idvoucher == "TET2021" && Total > 10000000) {
                    Total = Total - 1000000;
                }
                else if (idvoucher == "HE2021" && Total > 10000000) {
                    Total = Total - (Total * 5 / 100);
                }
                else {
                    swal("Thông báo", "Voucher is not available");
                }
                document.getElementById("totalmoney").innerHTML = Total;
                document.getElementById("totalmoney2").innerHTML = Total;
            });
        });

                //$(document).ready(function () {
                //    $("#voucher").click(function (event) {
                //        event.preventDefault();
                //        var vouchercode = $("#vouchercode").val();
                //        $.ajax({
                //            type: "POST",
                //            url: '/Cart/SubmitVoucher',
                //            data: {
                //                VoucherCode: vouchercode,
                //            },
                //            success: function (result) {
                //                $(".updatecartitem").text(result);
                //            }
                //        });
                //    });
                //});


    </script>


}