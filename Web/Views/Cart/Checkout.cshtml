@model List<ViewModel.ViewModels.CartItem>

<!DOCTYPE html>
<!--
    ustora by freshdesignweb.com
    Twitter: https://twitter.com/freshdesignweb
    URL: https://www.freshdesignweb.com/ustora/
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cart Page - Ustora Demo</title>

    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,700,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,100' rel='stylesheet' type='text/css'>

    <!-- Bootstrap -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>



    <div class="single-product-area">
        <div class="zigzag-bottom"></div>
        <div class="container">
            <div class="row">
               </div>

                @if (Model.Count > 0)
                {
                    var stt = 1;
                    decimal total = 0;
                    <div class="col-md-12">
                        <div class="product-content-right">
                            <div class="woocommerce">
                                <div style="">
                                    <h2 class="text-primary">Vui lòng nhập chính xác thông tin của bạn</h2>

                                    <form id="formpurchase" class="form-group">
                                        <div class="form-group">
                                            <input name="EmailShip" id="emailship" placeholder="Email" class="form-control col-md-8 mb-3" />
                                        </div>
                                        <input name="NameShip" id="nameship" placeholder="Họ và tên" class="form-control col-md-8 mb-3" />

                                        <input name="AddressShip" id="addressship" placeholder="Địa chỉ" class="form-control col-md-8 mb-3" />

                                        <input name="NumberShip" type="number" id="numbership" placeholder="Số điện thoại" class="form-control col-md-8 mb-3" />

                                        <textarea name="NoticeShip" id="noticeship" placeholder="Ghi chú" class="form-control col-md-8 mb-5"></textarea>

                                    </form>
                                </div>

                                <form method="post" action="#">
                                    <table cellspacing="0" class="shop_table cart">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th class="product-remove">&nbsp;</th>
                                                <th class="product-name">Tên sản phẩm</th>
                                                <th class="product-quantity">Số lượng</th>
                                                <th class="product-price">Giá</th>

                                                <th class="product-subtotal">Tổng cộng</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            @foreach (var cart in Model)
                                            {
                                                if (cart.Product.isGift == false)
                                                {
                                                    int thanhtien = (int)cart.Quantity * (int)cart.Product.Price;
                                                    total += thanhtien;
                                                    var a = (int)cart.Product.Price;

                                                    <tr class="cart_item">
                                                        <td>@(stt++)</td>

                                                        <td style="width:100px" class="product-thumbnail">
                                                            <a href="single-product.html"><img width="145" height="145" alt="poster_1_up" class="shop_thumbnail" src="~/@cart.Product.PhotoReview"></a>
                                                        </td>

                                                        <td class="product-name">
                                                            <a href="single-product.html">@cart.Product.ProductName</a>
                                                        </td>

                                                        <td class="product-quantity">
                                                            <div class="quantity buttons_added">
                                                                <input disabled type="number" size="4" asp-for="@cart.Quantity" id="Quanlity" class="input-text qty text" title="Qty">
                                                            </div>
                                                        </td>
                                                        <td class="product-price">
                                                            <span class="amount">@a.ToString("#,##0") VNĐ</span>
                                                        </td>



                                                        <td class="product-subtotal">
                                                            <span class="amount">@thanhtien.ToString("#,##0") VNĐ</span>
                                                        </td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr class="cart_item">
                                                        <td>@(stt++)</td>
                                                        <td style="height:100px ;width:80px" class="product-thumbnail">
                                                            <a href="single-product.html"><img alt="poster_1_up" class="shop_thumbnail" src="~/@cart.Product.PhotoReview"></a>
                                                        </td>

                                                        <td class="product-name">
                                                            <a href="single-product.html">@cart.Product.ProductName</a>
                                                        </td>
                                                        <td class="product-quantity">
                                                            <div class="quantity buttons_added">
                                                                <input type="number" size="4" value="1" disabled>
                                                            </div>
                                                        </td>
                                                        <td colspan="2">
                                                            <a class="btn btn-danger">
                                                                Sản phẩm tặng kèm miễn phí
                                                            </a>
                                                        </td>
                                                    </tr>

                                                }


                                            }
                                            <tr>
                                                <td class="actions" colspan="6">
                                                    <div class="coupon">
                                                        <label for="coupon_code">Coupon:</label>
                                                        <input style="width:100px" type="text" placeholder="Voucher" id="vouchercode" class="input-text" name="coupon_code">
                                                        <input id="voucher" data-total="@total" type="submit" value="Sử dụng" name="apply_coupon" class="button">
                                                    </div>
                                                    <div style="display:none" id="alerts" class="alert-primary col-md-4 ml-3">YOUR VOUCHER USE SUCCESS</div>
                                                </td>
                                            </tr>



                                        </tbody>
                                    </table>
                                </form>

                                <div class="cart-collaterals">
                                    <div class="cart_totals ">
                                        <h2>Cart Totals</h2>

                                        <table cellspacing="0">
                                            <tbody>
                                                <tr class="cart-subtotal">
                                                    <th>Cart Subtotal</th>
                                                    <td><span class="amount">@total.ToString("#,##0") VNĐ</span></td>
                                                </tr>
                                                <tr>
                                                    <th>Used Voucher</th>
                                                    <td id="totalmoney">@total.ToString("#,##0") VNĐ</td>
                                                </tr>
                                                <tr class="shipping">
                                                    <th>Shipping and Handling</th>
                                                    <td>Free Shipping</td>
                                                </tr>

                                                <tr class="order-total">
                                                    <th>Order Total</th>
                                                    <td id="totalmoney2">@total.ToString("#,##0") VNĐ </td>
                                                    <td style="display:none" id="totalmoney3">@total</td>
                                                </tr>
                                       
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="pay">
                                        <h2>Payment</h2>
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Payment Method</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><button id="purchase" class="btn btn-info">Payment on delivery</button></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:center"><a id="PassAmount" data-total="" class="btn btn-secondary "><span style="color:red;font-weight:bold">VN</span><span style="color:blue;font-weight:bold">PAY</span></a></td>
                                                </tr>
                                            </tbody>
                                        </table>

                                    </div>




                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>


    <!-- Latest jQuery form server -->
    <script src="https://code.jquery.com/jquery.min.js"></script>

    <!-- Bootstrap JS form CDN -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- jQuery sticky menu -->
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>

    <!-- jQuery easing -->
    <script src="/js/jquery.easing.1.3.min.js"></script>

    <!-- Main Script -->
    <script src="/js/main.js"></script>
</body>
</html>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation/dist/additional-methods.js"></script>
    <script>

        
        $(document).ready(function () {
            $(".paypal").click(function (event) {
                event.preventDefault();
                var Total = $(this).attr("data-total");
                $.ajax({
                    type: "POST",
                    url: '/Cart/PayPal',
                    data: {
                        Total: Total,
                    },
                    success: function (result) {
                        window.location.href = result;
                    }
                });
            });
        });


        $(document).ready(function () {
            $("#PassAmount").click(function () {
                var Amount = (document.getElementById("totalmoney3").textContent);
                var EmailShip = $("#emailship").val();
                var NameShip = $("#nameship").val();
                var AddressShip = $("#addressship").val();
                var NumberShip = $("#numbership").val();
                var NoticeShip = $("#noticeship").val();
                var voucherCOde = $("#vouchercode").val();
                $.ajax({
                    type: "POST",
                    url: '/Cart/PassAmount',
                    data: {
                        Amount: Amount,
                        voucherCode: voucherCOde,
                        EmailShip: EmailShip,
                        NameShip: NameShip,
                        AddressShip: AddressShip,
                        NumberShip: NumberShip,
                        NoticeShip: NoticeShip
                        
                    },
                    success: function (result) {
                        $("body").html(result);
                    }
                });
            });
        });


        function deli() {
            var total = document.getElementById("totalmoney2");
            total = parseInt(total.textContent);
            var check = document.getElementById("fastdeli");
            if (check.checked) {
                total = total + 50;
                $("#totalmoney2").html(total);
            }
            else
            {
                total = total - 50;
                $("#totalmoney2").html(total);
            }
        };


        $(document).ready(function () { //cart voucher js
            $("#voucher").click(function (event) {
                event.preventDefault();
                var Total = parseInt($(this).attr("data-total"));
                var idvoucher = $("#vouchercode").val();
                if (idvoucher == "TET2022" && Total > 100000) {
                    Total = Total - 50000;
                    $("#alerts").css("display", "");
                }
                else if (idvoucher == "HE2021" && Total > 100000) {
                    Total = Total - (Total * 5 / 100);
                }
                else {
                    swal("Thông báo", "Voucher is not available");
                    $("#alerts").css("display", "none");
                }
                document.getElementById("totalmoney").innerHTML = Total.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") + " VNĐ";
                document.getElementById("totalmoney2").innerHTML = Total.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") + " VNĐ";
            });
        });

        



                    //$(document).ready(function () {
                    //    $("#voucher").click(function (event) {
                    //        event.preventDefault();
                    //        var vouchercode = $("#vouchercode").val();
                    //        $.ajax({
                    //            type: "POST",
                    //            url: '/Cart/SubmitVoucher',
                    //            data: {
                    //                VoucherCode: vouchercode,
                    //            },
                    //            success: function (result) {
                    //                $(".updatecartitem").text(result);
                    //            }
                    //        });
                    //    });
                    //});
    </script>
    <script>
        $(document).ready(function () {
            $("#formpurchase").validate({
                rules: {
                    "EmailShip": {
                        required: true,
                    },
                    "NameShip": {
                        required: true,
                    },
                    "NumberShip": {
                        required: true,
                    },
                    "NoticeShip": {
                        required: true,
                    },
                    "AddressShip": {
                        required: true,
                    }
                },
                messages: {
                    "EmailShip": {
                        required: "Bắt buộc nhập Email"
                    },
                    "NameShip": {
                        required: "Bắt buộc nhập Nameship"
                    },
                    "NumberShip": {
                        required: "Bắt buộc nhập NumberShip"
                    },
                    "NoticeShip": {
                        required: "Bắt buộc nhập NoticeShip"
                    },
                    "AddressShip": {
                        required: "Bắt buộc nhập AddressShip"
                    }
                }


            });

            $(document).ready(function () {
            $("#purchase").click(function (event) {
                event.preventDefault();
                event.preventDefault();
                swal({
                    title: "Order Confirmation",
                    text: "The order cannot return when you order. Do you want to continue?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Continue to Buy",

                    cancelButtonText: "Close",
                    closeOnConfirm: false,
                    closeOnCancel: false
                },
                    function (isConfirm ) {
                        if (isConfirm && $("#formpurchase").valid() ) {
                            var EmailShip = $("#emailship").val();
                            var NameShip = $("#nameship").val();
                            var AddressShip = $("#addressship").val();
                            var NumberShip = $("#numbership").val();
                            var NoticeShip = $("#noticeship").val();
                            var voucherCOde = $("#vouchercode").val();
                            $.ajax({
                                type: "POST",               //update
                                url: '@Url.Action("Purchase","Cart")',
                                data: {
                                    voucherCode: voucherCOde,
                                    EmailShip: EmailShip,
                                    NameShip: NameShip,
                                    AddressShip: AddressShip,
                                    NumberShip: NumberShip,
                                    NoticeShip: NoticeShip
                                },
                                success: function (result) {
                                    window.alert = 'Order Success'
                                    window.location.href = '/Cart/Success?IdOrder=' + result;
                                }
                            });
                        } else {
                            swal("Close", "The order has not been sent , please complete your order", "error");
                        }
                    });
            });
        });


            
           
        });

    </script>
}


